<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Async</title>
    <meta name="description" content="Introduction to async programming">
    <meta name="author" content="Andreas Vilinski">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/style.css" />
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/deedle.css" />
    <link type="text/css" rel="stylesheet" href="css/custom.css" />
    <script src="fsharp.formatting/styles/tips.js" type="text/javascript"></script>
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <link rel="stylesheet" href="css/fsreveal.css">
    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
    <script language="javascript" type="text/javascript">
        function init()
        {
            websocket = new WebSocket("ws://"+window.location.host+"/websocket");
            websocket.onmessage = function(evt) { location.reload(); };
        }
        window.addEventListener("load", init, false);
    </script>
</head>
<body>
    <div class="reveal">
        <div class="tip" id="fs1">val urlList : string list<br /><br />Full name: index.urlList</div>
<div class="tip" id="fs2">val fetchHtmlAsync : url:string -&gt; Async&lt;string&gt;<br /><br />Full name: index.fetchHtmlAsync</div>
<div class="tip" id="fs3">val url : string</div>
<div class="tip" id="fs4">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs5">val uri : System.Uri</div>
<div class="tip" id="fs6">namespace System</div>
<div class="tip" id="fs7">Multiple items<br />type Uri =<br />&#160;&#160;new : uriString:string -&gt; Uri + 5 overloads<br />&#160;&#160;member AbsolutePath : string<br />&#160;&#160;member AbsoluteUri : string<br />&#160;&#160;member Authority : string<br />&#160;&#160;member DnsSafeHost : string<br />&#160;&#160;member Equals : comparand:obj -&gt; bool<br />&#160;&#160;member Fragment : string<br />&#160;&#160;member GetComponents : components:UriComponents * format:UriFormat -&gt; string<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;member GetLeftPart : part:UriPartial -&gt; string<br />&#160;&#160;...<br /><br />Full name: System.Uri<br /><br />--------------------<br />System.Uri(uriString: string) : unit<br />System.Uri(uriString: string, uriKind: System.UriKind) : unit<br />System.Uri(baseUri: System.Uri, relativeUri: string) : unit<br />System.Uri(baseUri: System.Uri, relativeUri: System.Uri) : unit</div>
<div class="tip" id="fs8">val webClient : System.Net.WebClient</div>
<div class="tip" id="fs9">namespace System.Net</div>
<div class="tip" id="fs10">Multiple items<br />type WebClient =<br />&#160;&#160;inherit Component<br />&#160;&#160;new : unit -&gt; WebClient<br />&#160;&#160;member BaseAddress : string with get, set<br />&#160;&#160;member CachePolicy : RequestCachePolicy with get, set<br />&#160;&#160;member CancelAsync : unit -&gt; unit<br />&#160;&#160;member Credentials : ICredentials with get, set<br />&#160;&#160;member DownloadData : address:string -&gt; byte[] + 1 overload<br />&#160;&#160;member DownloadDataAsync : address:Uri -&gt; unit + 1 overload<br />&#160;&#160;member DownloadFile : address:string * fileName:string -&gt; unit + 1 overload<br />&#160;&#160;member DownloadFileAsync : address:Uri * fileName:string -&gt; unit + 1 overload<br />&#160;&#160;member DownloadString : address:string -&gt; string + 1 overload<br />&#160;&#160;...<br /><br />Full name: System.Net.WebClient<br /><br />--------------------<br />System.Net.WebClient() : unit</div>
<div class="tip" id="fs11">val html : string</div>
<div class="tip" id="fs12">member System.Net.WebClient.AsyncDownloadString : address:System.Uri -&gt; Async&lt;string&gt;</div>
<div class="tip" id="fs13">val getHtmlList : (string list -&gt; string [])<br /><br />Full name: index.getHtmlList</div>
<div class="tip" id="fs14">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs15">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs16">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task -&gt; Async&lt;unit&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs17">static member Async.Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;</div>
<div class="tip" id="fs18">static member Async.RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:System.Threading.CancellationToken -&gt; &#39;T</div>
<div class="tip" id="fs19">val htmlList : string []<br /><br />Full name: index.htmlList</div>
<div class="tip" id="fs20">module Observable<br /><br />from Microsoft.FSharp.Control</div>
<div class="tip" id="fs21">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs22">Multiple items<br />val single : value:&#39;T -&gt; single (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.single<br /><br />--------------------<br />type single = System.Single<br /><br />Full name: Microsoft.FSharp.Core.single</div>
<div class="tip" id="fs23">Multiple items<br />module Map<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Map&lt;&#39;Key,&#39;Value (requires comparison)&gt; =<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface ICollection&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface IDictionary&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member Add : key:&#39;Key * value:&#39;Value -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member ContainsKey : key:&#39;Key -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member Remove : key:&#39;Key -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Map&lt;_,_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;</div>
<div class="tip" id="fs24">val set : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.set</div>

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section >
<section >
<h3>Async programming</h3>
<p>First about different approaches</p>
<ul>
<li>WWW - world wide waiting</li>
<li>APM - IAsyncResult</li>
<li>TPL - Task Parallell Library</li>
<li>async/await</li>
<li>Rx</li>
<li>Message queues</li>
<li>Actor - Erlang/Akka/Akka.NET</li>
</ul>
<aside class="notes">
First about different approaches, mostly in C# just becauses<br/>
</aside>
</section>
<section >
<h3>Traditional synchronous approach</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">public</span> <span class="k">class</span> MyReader
{
    <span class="k">var</span> fs <span class="o">=</span> File.OpenRead(<span class="s">@"c:\somefile.txt"</span>);
    <span class="k">byte</span>[] buffer <span class="o">=</span> <span class="k">new</span> <span class="k">byte</span>[fs.Length];
    <span class="k">public</span> <span class="k">int</span> Read(<span class="k">byte</span> [] buffer, <span class="k">int</span> offset, <span class="k">int</span> count);
}
</code></pre></td></tr></table>
<aside class="notes">
wasting user time<br/>
</aside>
</section>
</section>
<section >
<section >
<h3>APM</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">static</span> <span class="k">void</span> Main(<span class="k">string</span>[] args)
{
    <span class="k">byte</span>[] readBuffer;
    <span class="k">var</span> fs <span class="o">=</span> File.OpenRead(<span class="s">@"c:\somefile.txt"</span>);
    readBuffer <span class="o">=</span> <span class="k">new</span> <span class="k">byte</span>[fs.Length];
    <span class="k">var</span> result <span class="o">=</span> fs.BeginRead(readBuffer, <span class="n">0</span>, (<span class="k">int</span>)fs.Length,
      OnReadComplete, fs);

    <span class="c">//do other work here while file is read...</span>

    Console.ReadLine();
}
<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> OnReadComplete(IAsyncResult result)
{
    <span class="k">var</span> stream <span class="o">=</span> (FileStream)result.AsyncState;
    <span class="k">var</span> bytesRead <span class="o">=</span> stream.EndRead(result);
    Console.WriteLine(<span class="s">"Read {0} bytes successfully."</span>, bytesRead);
    stream.Dispose();
}
</code></pre></td></tr></table>
<aside class="notes">
callback hell<br/>
two methods Begin and End<br/>
</aside>
</section>
<section >
<h3>APM</h3>
<ul>
<li>Asynchronous Programming Model</li>
<li>Separate XYBegin und XYComplete methods - readability</li>
<li>No way to cancel</li>
<li>
No error handling
<ul>
<li>No <a href="https://msdn.microsoft.com/en-us/library/yh598w02.aspx">using</a> statement for resources possible - create and dispose in different methods</li>
</ul>
</li>
<li>No synchronization between callback and caller thread</li>
<li>No coordination for multiple async operations</li>
</ul>
</section>
<section >
<h3>APM</h3>
<p>APM with lambda indstead of separate method</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">static</span> <span class="k">void</span> Main(<span class="k">string</span>[] args)
{
  <span class="k">byte</span>[] readBuffer;
  <span class="k">var</span> fs <span class="o">=</span> File.OpenRead(<span class="s">@"c:\somefile.txt"</span>);
  readBuffer <span class="o">=</span> <span class="k">new</span> <span class="k">byte</span>[fs.Length];
  <span class="k">var</span> result <span class="o">=</span> fs.BeginRead(readBuffer, <span class="n">0</span>, (<span class="k">int</span>)fs.Length,
      asyncResult <span class="o">=</span><span class="o">&gt;</span>
      {
          <span class="k">var</span> bytesRead <span class="o">=</span> fs.EndRead(asyncResult);
          Console.WriteLine(<span class="s">"Read {0} bytes successfully."</span>, bytesRead);
          fs.Dispose();
      }, <span class="k">null</span>);

  <span class="c">//do other work here while file is read...</span>

  Console.ReadLine();
}
</code></pre></td></tr></table>
<aside class="notes">
instead of second method you can write a lambda. Other disadvantages are still here<br/>
</aside>
</section>
</section>
<section >
<section >
<h3>TAP</h3>
<ul>
<li>Task-based Asynchronous Programming</li>
<li><a href="https://msdn.microsoft.com/en-us/library/system.threading.tasks.task(v=vs.110).aspx">System.Threading.Tasks.Task<TResult></a></li>
<li>Promice or Future in other languages</li>
</ul>
</section>
<section >
<h3>TAP - Task-based Async Programming</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">private</span> <span class="k">static</span> Task&lt;<span class="k">int</span>&gt; ReadFileAsync(<span class="k">string</span> filePath)
{
    <span class="k">var</span> fs <span class="o">=</span> File.OpenRead(filePath);
    <span class="k">var</span> readBuffer <span class="o">=</span> <span class="k">new</span> <span class="k">byte</span>[fs.Length];
    <span class="k">var</span> readTask <span class="o">=</span> fs.ReadAsync(readBuffer, <span class="n">0</span>, (<span class="k">int</span>)fs.Length);
    readTask.ContinueWith(task <span class="o">=</span><span class="o">&gt;</span>
    {
        <span class="k">if</span> (task.Status <span class="o">=</span><span class="o">=</span> TaskStatus.RanToCompletion)
            Console.WriteLine(<span class="s">"Read {0} bytes from file {1}"</span>,
              task.Result, filePath);
        <span class="k">else</span>
            Console.WriteLine(<span class="s">"Error with file {0}."</span>, filePath);
        fs.Dispose();
    });
    <span class="k">return</span> readTask;
}
</code></pre></td></tr></table>
<aside class="notes">
Now you can chain computations, cancel them<br/>
Continuation can be fired on special computation results like success or error<br/>
Code clutter with lambdas or separate methods for each continuation<br/>
</aside>
</section>
<section >
<h3>TAP - Task-based Async Programming</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">static</span> <span class="k">void</span> Main(<span class="k">string</span>[] args)
{
    <span class="k">var</span> read<span class="n">1</span> <span class="o">=</span> ReadFileAsync(<span class="s">@"c:\somefile.txt"</span>);
    <span class="k">var</span> read<span class="n">2</span> <span class="o">=</span> ReadFileAsync(<span class="s">@"c:\someotherfile.txt"</span>);
    Task.WhenAll(read<span class="n">1</span>, read<span class="n">2</span>)
        .ContinueWith(task <span class="o">=</span><span class="o">&gt;</span> Console.WriteLine(<span class="s">"All done."</span>));   
    <span class="c">//do other work here while files are read...</span>
}
</code></pre></td></tr></table>
<aside class="notes">
Can handle multiple computations a once<br/>
</aside>
</section>
<section >
<h3>TAP - Promise in JavaScript</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">asyncThing<span class="n">1</span>().then(<span class="k">function</span>() {
  <span class="k">return</span> asyncThing<span class="n">2</span>();
}).then(<span class="k">function</span>() {
  <span class="k">return</span> asyncThing<span class="n">3</span>();
}).<span class="k">catch</span>(<span class="k">function</span>(err) {
  <span class="k">return</span> asyncRecovery<span class="n">1</span>();
}).then(<span class="k">function</span>() {
  <span class="k">return</span> asyncThing<span class="n">4</span>();
}, <span class="k">function</span>(err) {
  <span class="k">return</span> asyncRecovery<span class="n">2</span>();
}).<span class="k">catch</span>(<span class="k">function</span>(err) {
  console.log(<span class="s">"Don't worry about it"</span>);
}).then(<span class="k">function</span>() {
  console.log(<span class="s">"All done!"</span>);
});
</code></pre></td></tr></table>
</section>
<section >
<h3>TAP - Future in scala</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="scala">var rateQuote = Future {
  exchange.getCurrentValue(USD)
}

val purchase = rateQuote map { quote =&gt;
  if (isProfitable(quote)) exchange.buy(amount, quote)
  else throw new Exception("not profitable")
}

purchase onSuccess {
  case _ =&gt; println("Purchased " + amount + " USD")
}
</code></pre></td></tr></table>
</section>
</section>
<section >
<section >
<h3>Async/Await - sugar for TAP</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="cs"><span class="k">private</span> <span class="k">static</span> <span class="k">async</span> Task&lt;<span class="k">int</span>&gt; ReadFileAsync(<span class="k">string</span> filePath)
{
    <span class="k">var</span> bytesRead <span class="o">=</span> <span class="n">0</span>;
    <span class="k">try</span>
    {
        <span class="k">using</span> (<span class="k">var</span> fs <span class="o">=</span> File.OpenRead(filePath))
        {
            <span class="k">var</span> readBuffer <span class="o">=</span> <span class="k">new</span> Byte[fs.Length];
            bytesRead <span class="o">=</span> await fileStream.ReadAsync(readBuffer, <span class="n">0</span>, (<span class="k">int</span>)fs.Length);             
            Console.WriteLine(<span class="s">"{0} bytes from file {1}"</span>, bytesRead, filePath);
            <span class="k">return</span> bytesRead;
        }
    }
    <span class="k">catch</span>(Exception)
    {
        Console.WriteLine(<span class="s">"Error while reading file {0}."</span>, filePath);
        <span class="k">return</span> bytesRead;
    }
}
</code></pre></td></tr></table>
</section>
<section >
<h3>whats wrong with asyn/await in c#</h3>
<ul>
<li><a href="http://tomasp.net/blog/csharp-async-gotchas.aspx/">C# async gotchas</a></li>
<li>Avoid a void</li>
<li>Simple deadlocks by newbies</li>
<li>Issues with nesting</li>
<li>
Not obvious where runs the code - <code>Await.Configure()</code>
<ul>
<li>Which part runs synchronously</li>
</ul>
</li>
</ul>
</section>
<section >
<h3>Compare to originals - async in F#</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">urlList</span> <span class="o">=</span> [
    <span class="s">&quot;http://www.microsoft.com&quot;</span>
    <span class="s">&quot;http://www.google.com&quot;</span>
    <span class="s">&quot;http://www.amazon.com&quot;</span> ]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="f">fetchHtmlAsync</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">url</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">async</span> {
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">uri</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="t">Uri</span>(<span onmouseout="hideTip(event, 'fs3', 8)" onmouseover="showTip(event, 'fs3', 8)" class="i">url</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="i">webClient</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs6', 10)" onmouseover="showTip(event, 'fs6', 10)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="i">Net</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="t">WebClient</span>()
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="i">html</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 14)" onmouseover="showTip(event, 'fs8', 14)" class="i">webClient</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="f">AsyncDownloadString</span>(<span onmouseout="hideTip(event, 'fs5', 16)" onmouseover="showTip(event, 'fs5', 16)" class="i">uri</span>)
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="i">html</span>
}

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 18)" onmouseover="showTip(event, 'fs13', 18)" class="f">getHtmlList</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs14', 19)" onmouseover="showTip(event, 'fs14', 19)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 20)" onmouseover="showTip(event, 'fs15', 20)" class="f">map</span> <span onmouseout="hideTip(event, 'fs2', 21)" onmouseover="showTip(event, 'fs2', 21)" class="f">fetchHtmlAsync</span>    <span class="c">// Build an Async&lt;&#39;a&gt; for each site</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 23)" onmouseover="showTip(event, 'fs17', 23)" class="f">Parallel</span>         <span class="c">// each Async&lt;&#39;a&gt; across different threads</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs16', 24)" onmouseover="showTip(event, 'fs16', 24)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 25)" onmouseover="showTip(event, 'fs18', 25)" class="f">RunSynchronously</span> <span class="c">// Run each Async&lt;&#39;a&gt;, non-blocking wait</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 26)" onmouseover="showTip(event, 'fs19', 26)" class="i">htmlList</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs1', 27)" onmouseover="showTip(event, 'fs1', 27)" class="i">urlList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 28)" onmouseover="showTip(event, 'fs13', 28)" class="f">getHtmlList</span>
</code></pre></td>
</tr>
</table>
</section>
</section>
<section >
<section >
<h3><a href="http://reactivex.io">Reactive Extensions</a> - another approach to asynchronity</h3>
<table>
<th><td>sync/pull</td><td>async/push</td></th>
<tr><td>one</td><td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">TResult</span>
</code></pre></td>
</tr>
</table>
</td><td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">Task</span><span class="o">&lt;</span><span class="i">TResult</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
</td></tr>
<tr><td>multiple</td><td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">IEnumerable</span><span class="o">&lt;</span><span class="i">TResult</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
</td><td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">IObservable</span><span class="o">&lt;</span><span class="i">TResult</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
</td></tr>
</table>
<ul>
<li>The Observer pattern done right</li>
<li>Invented in C# by <a href="https://twitter.com/headinthebox">Erik Meyer</a></li>
<li>
Choose your plattform:
<ul>
<li><a href="https://github.com/Reactive-Extensions/Rx.NET">Rx.NET</a>, <a href="https://github.com/ReactiveX/RxScala">RxScala</a>, RxJava, RxJS, RxSwift, ...</li>
</ul>
</li>
</ul>
</section>
<section >
<h3>Rx - <a href="https://queue.acm.org/detail.cfm?id=2169076">Your Mouse is a Database</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">TextChanges</span>(<span class="i">input</span>)
  <span class="o">.</span><span class="i">DistinctUntilChanged</span>()
  <span class="o">.</span><span class="i">Throttle</span>(<span class="i">TimeSpan</span><span class="o">.</span><span class="i">FromMilliSeconds</span>(<span class="n">10</span>))
  <span class="o">.</span><span class="i">Select</span>(<span class="i">word</span><span class="o">=&gt;</span><span class="i">Completions</span>(<span class="i">word</span>))
  <span class="o">.</span><span class="i">Switch</span>()
  <span class="o">.</span><span class="i">Subscribe</span>(<span class="i">ObserveChanges</span>(<span class="i">output</span>));
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Rx - reactive Paint in WPF</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">var</span> <span class="i">mouseDown</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="i">Observable</span>
  <span class="o">.</span><span class="i">FromEvent</span><span class="o">&lt;</span><span class="i">MouseButtonEventArgs</span><span class="o">&gt;</span>(<span class="i">image</span>, <span class="s">&quot;MouseDown&quot;</span>)
  <span class="o">.</span><span class="i">Select</span>(<span class="i">evt</span> <span class="o">=&gt;</span> <span class="i">evt</span><span class="o">.</span><span class="i">EventArgs</span><span class="o">.</span><span class="i">GetPosition</span>(<span class="i">image</span>));
<span class="i">var</span> <span class="i">mouseUp</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 30)" onmouseover="showTip(event, 'fs20', 30)" class="i">Observable</span>
  <span class="o">.</span><span class="i">FromEvent</span><span class="o">&lt;</span><span class="i">MouseButtonEventArgs</span><span class="o">&gt;</span>(<span class="i">image</span>, <span class="s">&quot;MouseUp&quot;</span>);
<span class="i">var</span> <span class="i">mouseMove</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 31)" onmouseover="showTip(event, 'fs20', 31)" class="i">Observable</span>
  <span class="o">.</span><span class="i">FromEvent</span><span class="o">&lt;</span><span class="i">MouseEventArgs</span><span class="o">&gt;</span>(<span class="i">image</span>, <span class="s">&quot;MouseMove&quot;</span>)
  <span class="o">.</span><span class="i">Select</span>(<span class="i">evt</span> <span class="o">=&gt;</span> <span class="i">evt</span><span class="o">.</span><span class="i">EventArgs</span><span class="o">.</span><span class="i">GetPosition</span>(<span class="i">this</span>));
<span class="i">var</span> <span class="i">q</span> <span class="o">=</span> <span class="i">mouseDown</span>
  <span class="o">.</span><span class="i">SelectMany</span>(<span class="i">imageOffset</span> <span class="o">=&gt;</span> <span class="i">mouseMove</span><span class="o">.</span><span class="i">TakeUntil</span>(<span class="i">mouseUp</span>),
    (<span class="i">imageOffset</span>, <span class="i">pos</span>) <span class="o">=&gt;</span> <span class="k">new</span> <span class="i">Point</span>
    {
      <span class="i">X</span> <span class="o">=</span> <span class="i">pos</span><span class="o">.</span><span class="i">X</span> <span class="o">-</span> <span class="i">imageOffset</span><span class="o">.</span><span class="i">X</span>,
      <span class="i">Y</span> <span class="o">=</span> <span class="i">pos</span><span class="o">.</span><span class="i">Y</span> <span class="o">-</span> <span class="i">imageOffset</span><span class="o">.</span><span class="i">Y</span>
    })
    <span class="o">.</span><span class="i">Subscribe</span>(<span class="i">Observer</span><span class="o">.</span><span class="i">Create</span><span class="o">&lt;</span><span class="i">Point</span><span class="o">&gt;</span>(<span class="i">p</span> <span class="o">=&gt;</span>
    {
      <span class="i">Canvas</span><span class="o">.</span><span class="i">SetLeft</span>(<span class="i">image</span>, <span class="i">p</span><span class="o">.</span><span class="i">X</span>);
      <span class="i">Canvas</span><span class="o">.</span><span class="i">SetTop</span>(<span class="i">image</span>, <span class="i">p</span><span class="o">.</span><span class="i">Y</span>);
    }));
</code></pre></td>
</tr>
</table>
</section>
</section>
<section >
<h3>Message queues</h3>
<table style="width:100%">
<tr>
<td>
<p>Implementations:</p>
<ul>
<li><a href="kafka.apache.org">Kafka</a></li>
<li>ZeroMQ</li>
<li><a href="https://rabbitmq.com">RabbitMQ</a></li>
<li>ActiveMQ</li>
<li>Apache Qpid</li>
<li>IronMQ</li>
</ul>
</td>
<td>
<p>Advantages:</p>
<ul>
<li><a href="http://www.kuntalganguly.com/2014/08/message-queue-comparision.html">Fast</a> - <a href="http://bravenewgeek.com/dissecting-message-queues/">some</a> <a href="http://blog.x-aeon.com/2013/04/10/a-quick-message-queue-benchmark-activemq-rabbitmq-hornetq-qpid-apollo/">benchmarks</a></li>
<li>Asynchronous - Queue it now, run later</li>
<li>Clients in any language,</li>
<li>AMPQ - common protocol</li>
<li>Decoupling - Separates app logic</li>
<li>Resilience: Won't crash whole app</li>
<li>Redundancy: Retry failed jobs</li>
<li>Guarantees: message survives restart</li>
<li>Scalable: workers per job</li>
<li>Free monitoring tools</li>
</ul>
</td>
</tr>
</table>
</section>
<section >
<h3>RAM footprint per unit of concurrency (approx)</h3>
<table id="concurrency-table">
<tr class="haskell">
    <td class="num">1.3KB</td>
    <td class="name"><div class="bar-ctr"><div class="bar"></div></div><span>Haskell ThreadId + MVar (GHC 7.6.3, 64-bit)</span></td>
</tr>
<tr class="erlang">
    <td class="num">2.6 KB</td>
    <td class="name"><div class="bar-ctr"><div class="bar"></div></div><span>Erlang process (64-bit)</span></td>
</tr>
<tr class="go">
    <td class="num">4.0 KB</td>
    <td class="name"><div class="bar-ctr"><div class="bar"></div></div><span>Go goroutine</span></td>
	<!-- http://tip.golang.org/doc/go1.3#stack_size -->
</tr>
<tr class="c-min">
    <td class="num">9.0 KB</td>
    <td class="name"><div class="bar-ctr"><div class="bar"></div></div><span>C pthread (minimum, 64-bit Mac OS X)</span></td>
    <!-- http://opensource.apple.com/source/Libc/Libc-594.9.5/include/limits.h -->
</tr>
<tr class="java-min">
    <td class="num">64.0 KB</td>
    <td class="name"><div class="bar-ctr"><div class="bar"></div></div><span>Java thread stack (minimum)</span></td>
    <!-- http://www.oracle.com/technetwork/java/hotspotfaq-138619.html#threads_oom -->
</tr>
<tr class="placeholder"><td colspan="2"><hr/></td></td>
<tr class="c">
    <td class="num">513 KB</td>
    <td class="name"><div class="bar-ctr"><div class="bar"></div></div><span>C pthread (default, 64-bit Mac OS X)</span></td>
    <!-- https://developer.apple.com/library/mac/documentation/cocoa/conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW7 -->
</tr>
<tr class="java">
    <td class="num">1024 KB</td>
    <td class="name"><div class="bar-ctr"><div class="bar"></div></div><span>Java thread stack (default)</span></td>
    <!-- http://www.oracle.com/technetwork/java/hotspotfaq-138619.html#threads_oom -->
</tr>
</table>
</section>
<section >
<section >
<h3>Akka</h3>
<ul>
<li>Inspired from <a href="http://www.erlang.org">Erlang</a> processes</li>
<li>Originally not type safe. Erlang is dynamic</li>
<li>Async OOP over messaging - "share nothing"</li>
<li>In-process usable too - spray</li>
<li>Failure safe</li>
<li>Supervision trees</li>
<li>Back-pressure - Publisher/Subscriber</li>
<li>Low level - extra programming effort</li>
<li>Own communication protocol</li>
</ul>
</section>
<section >
<h3><a href="spray.io">spray</a>/akka-http</h3>
<ul>
<li>
Both
<ul>
<li>Scala-Frameworks</li>
<li>Actor-Based - Akka</li>
<li>Performant enough - at least for us</li>
<li>Routing DSL</li>
<li>Test-Libraries - akka-testkit, spray-testkit, akka-http-testkit</li>
</ul>
</li>
</ul>
</section>
<section >
<h3><a href="spray.io">spray</a></h3>
<ul>
<li>Production-Ready</li>
<li>Well documented</li>
<li>spray-testkit</li>
<li>No more features - only support</li>
<li>No WebSockets - most requested feature ever</li>
</ul>
</section>
<section >
<h3>akka-http</h3>
<ul>
<li>
Successor development of Spray
<ul>
<li>
<a href="http://akka.io/news/2015/07/15/akka-streams-1.0-released.html">1.0</a> (Jul 15 2015)
<ul>
<li>Much slower than spray</li>
</ul>
</li>
<li>
<a href="http://akka.io/news/2015/11/05/akka-streams-2.0-M1-released.html">2.0-M1</a> - (Nov 05 2015)
<ul>
<li>API unification - routing, marshalling, http</li>
</ul>
</li>
<li>2.0 - soon?</li>
</ul>
</li>
<li>Not yet complete docs - fallback to spray docs</li>
<li>
Additional features:
<ul>
<li>WebSockets</li>
<li>Streams</li>
</ul>
</li>
</ul>
</section>
<section >
<h3>akka-http - WebSockets</h3>
<ul>
<li>No long polling</li>
<li>Persistent Client-Server connection</li>
<li>Full-Duplex</li>
<li>Much smaller header - efficient communication</li>
</ul>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">path</span>(<span class="s">&quot;ws&quot;</span>) {
  <span class="k">val</span> <span class="i">handler</span> <span class="o">=</span> <span class="i">Flow</span><span class="o">.</span><span class="i">fromSinkAndSource</span>(
      <span class="i">Sink</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 32)" onmouseover="showTip(event, 'fs21', 32)" class="i">ignore</span>,
      <span class="i">Source</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 33)" onmouseover="showTip(event, 'fs22', 33)" class="i">single</span>(<span class="i">TextMessage</span>(<span class="s">&quot;Hello World!&quot;</span>))
    )
  <span class="i">handleWebsocketMessages</span>(<span class="i">handler</span>)
}
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>akka-streams</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="scala">//types:
Source[Out,Mat]
  Flow[In, Out, Mat]
  Sink[In, Mat]

val ready = Source(someSource)
    .via(flow).map(_ * 2)
    .to(sink)

val mat: Mat = ready.run()

val f: Future[String] = Source.single(1)
    .map (_ .toString)
    .runWith(Sink.head)
</code></pre></td></tr></table>
<aside class="notes">
web request as a stream already in other FP frameworks too - Haskell, F#<br/>
</aside>
</section>
<section >
<h3>akka-streams</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="scala">//types:
Source[Int,Unit]
  Flow[Int, String, Unit]
       Sink[String, Future[String]]
</code></pre></td></tr></table>
</section>
</section>
<section >
<section >
<h3>Scala Vor/Nachteile</h3>
<ul>
<li>
<strong>PRO</strong>
<ul>
<li>FP + OOP</li>
<li>Reach type system</li>
<li>JVM</li>
<li>
big community -&gt; a lot of libs
<ul>
<li>Hadoop, Spark, etc.</li>
</ul>
</li>
<li>Type classes</li>
</ul>
</li>
</ul>
</section>
<section >
<ul>
<li>
<strong>CONTRA</strong>
<ul>
<li>Jar/SBT hell</li>
<li>Implicits hell - drop IDEA to Sublime</li>
<li>Slow compiler, IDEs</li>
<li>
Not a better Java
<ul>
<li>Wannabe Haskell for JVM, really - C# alike</li>
<li>Verbose</li>
<li>Complex type system =&gt; weaker type inference</li>
<li>Too much of OOP - inheritance hell</li>
</ul>
</li>
<li>Lessons learnt on <a href="https://github.com/janm399/akka-patterns/wiki/Lessons-Learnt---Fommil">Akka/Scala/Spray</a></li>
<li><a href="https://www.youtube.com/watch?v=TS1lpKBMkgg">We're Doing It All Wrong</a> by Paul Phillips</li>
<li><a href="http://lukeplant.me.uk/blog/posts/less-powerful-languages/">We need less powerful languages</a> by <a href="http://lukeplant.me.uk">Luke Plant</a></li>
</ul>
</li>
</ul>
</section>
<section >
<h3>Scala - Powerfull type system</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// a fictional idealized version of the genuine method</span>
<span class="i">def</span> <span class="i">map</span>[<span class="i">B</span>](<span class="i">f</span><span class="o">:</span> (<span class="i">A</span>) <span class="o">=&gt;</span> <span class="i">B</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs23', 34)" onmouseover="showTip(event, 'fs23', 34)" class="i">Map</span>[<span class="i">B</span>]
</code></pre></td>
</tr>
</table>
<div class="fragment">
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// the laughably labeled &quot;full&quot; signature</span>
<span class="i">def</span> <span class="i">map</span>[<span class="i">B</span>, <span class="i">That</span>](<span class="i">f</span><span class="o">:</span> ((<span class="i">A</span>,<span class="i">B</span>)) <span class="o">=&gt;</span> <span class="i">B</span>)
  (<span class="i">implicit</span> <span class="i">bf</span><span class="o">:</span> <span class="i">CanBuildFrom</span>[<span onmouseout="hideTip(event, 'fs23', 35)" onmouseover="showTip(event, 'fs23', 35)" class="i">Map</span>[<span class="i">A</span>,<span class="i">B</span>], <span class="i">B</span>, <span class="i">That</span>]) <span class="o">:</span> <span class="i">That</span>
</code></pre></td>
</tr>
</table>
</div>
<div class="fragment">has FOUR distinct identifiers</div>
<div class="fragment">neither has any basis in reality!</div>
</section>
<section >
<h3>Scala - predictable</h3>
<ul>
<li><a href="http://de.slideshare.net/extempore/a-scala-corrections-library">A scala corrections library</a> by Paul Phillips</li>
<li>One of them returns 2, other returns never: Feeling lucky?</li>
</ul>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">(<span class="i">Stream</span> <span class="i">from</span> <span class="n">1</span>) <span class="i">zip</span> (<span class="i">Stream</span> <span class="i">from</span> <span class="n">1</span>)
  <span class="i">map</span> { <span class="i">case</span> (<span class="i">x</span>,<span class="i">y</span>) <span class="o">=&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span> } <span class="i">head</span>
(<span class="i">Stream</span> <span class="i">from</span> <span class="n">1</span>, <span class="i">Stream</span> <span class="i">from</span> <span class="n">1</span>)<span class="o">.</span><span class="i">zipped</span>
  <span class="i">map</span> { <span class="i">case</span> (<span class="i">x</span>,<span class="i">y</span>) <span class="o">=&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span> } <span class="i">head</span>
</code></pre></td>
</tr>
</table>
</section>
</section>
<section >
<h3>F# compared to Scala</h3>
<ul>
<li>Simple, conciser syntax - less <code>{}();</code> more <code>|&gt; &gt;&gt; &gt;&gt;= &gt;=&gt;</code></li>
<li>Async and Actor included</li>
<li>Powerful Hindley-Milner type inference</li>
<li><a href="http://fsharpforfunandprofit.com/posts/cycles-and-modularity-in-the-wild/">No circular dependencies</a></li>
<li>No implicit conversions</li>
<li>More FP than OOP</li>
<li>
Good, fast, free IDEs with intellisense
<ul>
<li>VS Community Edition, VS-Code, Atom, Emacs, Vim, ...</li>
</ul>
</li>
<li>
Full stack libraries
<ul>
<li><a href="https://panesofglass.github.io/TodoBackendFSharp/#/">Web</a>, <a href="http://mbrace.io">Cloud</a>, <a href="http://www.aleagpu.com">GPU</a>, Desktop, Mobile, ...</li>
</ul>
</li>
<li>Scripting and REPL</li>
</ul>
<aside class="notes">
circular dependencies<br/>
</aside>
</section>
<section >
<h3>CLR - better JVM</h3>
<p>It's a moot point, but:</p>
<ul>
<li>Real generics</li>
<li>Real tile recursion optimization</li>
<li>Value types</li>
<li>Easier native calls - c/c++</li>
<li>Runs on linux too +-</li>
</ul>
</section>
<section >
<h3>F#-only features</h3>
<ul>
<li>
Computation expressions:
<ul>
<li><strong><em>async</em></strong>, query, seq, cloud, log, mongo, ...</li>
</ul>
</li>
<li>
Type providers - for any structured data
<ul>
<li>sql, csv, xml, json, wmi, odata, wsdl, hadoop/hive, typescript, excel, swagger, registry, chess...</li>
</ul>
</li>
<li>Measure-types - currency, physical units</li>
<li>Discriminated unions - compare to inheritance hell</li>
<li>Active patterns - compare to scala unapply</li>
</ul>
</section>
<section >
<h3>F# Mongo driver</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">collection</span> <span class="o">:</span> <span class="i">IMongoCollection</span><span class="o">&lt;</span><span class="i">Item</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">..</span><span class="o">.</span>

<span class="i">mongo</span> {
    <span class="k">for</span> <span class="i">x</span> <span class="k">in</span> <span class="i">collection</span> <span class="k">do</span>
    <span class="i">update</span>
    <span onmouseout="hideTip(event, 'fs24', 36)" onmouseover="showTip(event, 'fs24', 36)" class="i">set</span> <span class="i">x</span><span class="o">.</span><span class="i">Price</span> <span class="n">0.99</span>
    <span class="i">inc</span> <span class="i">x</span><span class="o">.</span><span class="i">Quantity</span> <span class="n">1</span>
}
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Akka.NET</h3>
<ul>
<li>Akka for .NET</li>
<li>Ported from Scala</li>
<li>Written in C#</li>
<li>API for F#</li>
<li>Portable - mono on Unix</li>
<li>Production ready</li>
</ul>
</section>


        </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
        // Add the nohighlight class and data-noescape attribute to code elements that have already been formatted by FSharp.Formatting
        $('pre.highlighted code').addClass('nohighlight').attr('data-noescape', '');

        // Full list of configuration options available here:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

            // Parallax scrolling
            // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
            // parallaxBackgroundSize: '2100px 900px',

            // Optional libraries used to extend on reveal.js
            dependencies: [
                { src: 'lib/js/classList.js', condition: function () { return !document.body.classList; } },
                { src: 'plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
                { src: 'plugin/zoom-js/zoom.js', async: true, condition: function () { return !!document.body.classList; } },
                { src: 'plugin/notes/notes.js', async: true, condition: function () { return !!document.body.classList; } }
            ]
        });

    </script>
</body>
</html>

